/**
 * @license RequireJS domReady 1.0.0 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */
define("domReady",[],function(){function i(a){for(var b=0,d;d=a[b];b++)d(c)}function j(){var a=d,c=e;b&&(a.length&&(d=[],i(a)),f.resourcesDone&&c.length&&(e=[],i(c)))}function k(){b||(b=!0,h&&clearInterval(h),j())}function l(a){return b?a(c):d.push(a),l}var a=typeof window!="undefined"&&window.document,b=!a,c=a?document:null,d=[],e=[],f=requirejs||require||{},g=f.resourcesReady,h;return"resourcesReady"in f&&(f.resourcesReady=function(a){g&&g(a),a&&j()}),a&&(document.addEventListener?(document.addEventListener("DOMContentLoaded",k,!1),window.addEventListener("load",k,!1)):window.attachEvent&&(window.attachEvent("onload",k),self===self.top&&(h=setInterval(function(){try{document.body&&(document.documentElement.doScroll("left"),k())}catch(a){}},30))),document.readyState==="complete"&&k()),l.withResources=function(a){return b&&f.resourcesDone?a(c):e.push(a),l},l.version="1.0.0",l.load=function(a,b,c,d){d.isBuild?c(null):l(c)},l}),define("alea",[],function(){function a(){var a=4022871197,b=function(b){b=b.toString();for(var c=0;c<b.length;c++){a+=b.charCodeAt(c);var d=.02519603282416938*a;a=d>>>0,d-=a,d*=a,a=d>>>0,d-=a,a+=d*4294967296}return(a>>>0)*2.3283064365386963e-10};return b.version="Mash 0.9",b}function b(){return function(b){var c=0,d=0,e=0,f=1;b.length==0&&(b=[+(new Date)]);var g=a();c=g(" "),d=g(" "),e=g(" ");for(var h=0;h<b.length;h++)c-=g(b[h]),c<0&&(c+=1),d-=g(b[h]),d<0&&(d+=1),e-=g(b[h]),e<0&&(e+=1);g=null;var i=function(){var a=2091639*c+f*2.3283064365386963e-10;return c=d,d=e,e=a-(f=a|0)};i.uint32=function(){return i()*4294967296},i.fract53=function(){return i()+(i()*2097152|0)*1.1102230246251565e-16},i.choice=function(a){var b=Math.floor(i()*a.length);return a[b]};var j=function(){return i()-.5};return i.shuffle=function(a){a.sort(j)},i.version="Alea 0.9",i.args=b,i}(Array.prototype.slice.call(arguments))}return{Random:b}}),define("compat",[],function(){Function.prototype.bind||(Function.prototype.bind=function(a){var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d?this:a||window,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),Object.freeze||(Object.freeze=function(a){return a});var a=function(){console.warn("Faking Web Worker creation.")};a.prototype={postMessage:function(a){},addEventListener:function(a,b){}};var b={Worker:typeof Worker=="undefined"?a:Worker,Uint8Array:typeof Uint8Array=="undefined"?Array:Uint8Array,Float64Array:typeof Float64Array=="undefined"?Array:Float64Array};return typeof window!="undefined"&&function(){var a=0,c=["ms","moz","webkit","o"],d;for(d=0;d<c.length&&!window.requestAnimationFrame;++d)window.requestAnimationFrame=window[c[d]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[c[d]+"CancelAnimationFrame"]||window[c[d]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(console.log("Using requestAnimationFrame fallback."),window.requestAnimationFrame=function(b,c){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)}),b.requestAnimationFrame=window.requestAnimationFrame.bind(window),b.cancelAnimationFrame=window.cancelAnimationFrame.bind(window)}(),b}),define("webintent",[],function(){var a=window.Cordova||{addConstructor:function(){}},b=function(){};return b.ACTION_SEND="android.intent.action.SEND",b.ACTION_VIEW="android.intent.action.VIEW",b.EXTRA_TEXT="android.intent.extra.TEXT",b.EXTRA_SUBJECT="android.intent.extra.SUBJECT",b.EXTRA_STREAM="android.intent.extra.STREAM",b.EXTRA_EMAIL="android.intent.extra.EMAIL",b.prototype.startActivity=function(b,c,d){return a.exec(function(a){c(a)},function(a){d(a)},"WebIntent","startActivity",[b])},b.prototype.sendBroadcast=function(b,c,d){return a.exec(function(a){c(a)},function(a){d(a)},"WebIntent","sendBroadcast",[b])},b.prototype.hasExtra=function(b,c,d){return a.exec(function(a){c(a)},function(a){d(a)},"WebIntent","hasExtra",[b])},b.prototype.getUri=function(b,c){return a.exec(function(a){b(a)},function(a){c(a)},"WebIntent","getUri",[])},b.prototype.getExtra=function(b,c,d){return a.exec(function(a){c(a)},function(a){d(a)},"WebIntent","getExtra",[b])},b.prototype.onNewIntent=function(b){return a.exec(function(a){b(a)},function(a){},"WebIntent","onNewIntent",[])},a.addConstructor(function(){a.addPlugin("webintent",new b)}),b}),define("funf",["./webintent"],function(a){var b="edu.mit.media.funf.RECORD",c="edu.mit.media.funf.ARCHIVE",d="mainPipeline",e=function(a){console.assert(a.indexOf("-")<0,"funf doesn't like hyphens in the appName"),this.appName=a};return e.prototype={},e.prototype.record=function(a,b){},e.prototype.archive=function(){},window&&window.Cordova&&window.Cordova.exec&&window.device&&window.device.platform==="Android"&&(e.prototype.record=function(c,e){typeof e=="object"&&(e=JSON.stringify(e));var f=new a,g={name:c,value:e,millis:Date.now()};f.sendBroadcast({action:b,extras:{DATABASE_NAME:d,TIMESTAMP:Math.floor(Date.now()/1e3),NAME:this.appName,VALUE:JSON.stringify(g)}},function(a){},function(a){console.error("Funf logging failed.")})},e.prototype.archive=function(){(new a).sendBroadcast({action:c,extras:{DATABASE_NAME:d}},function(){},function(){})}),e}),define("lawnchair/core",[],function(){var a=function(b,c){if(!(this instanceof a))return new a(b,c);if(!JSON)throw"JSON unavailable! Include http://www.json.org/json2.js to fix.";if(arguments.length<=2&&arguments.length>0)c=typeof arguments[0]=="function"?arguments[0]:arguments[1],b=typeof arguments[0]=="function"?{}:arguments[0];else throw"Incorrect # of ctor args!";if(typeof c!="function")throw"No callback was provided";this.record=b.record||"record",this.name=b.name||"records";var d;if(b.adapter){for(var e=0,f=a.adapters.length;e<f;e++)if(a.adapters[e].adapter===b.adapter){d=a.adapters[e].valid()?a.adapters[e]:undefined;break}}else for(var e=0,f=a.adapters.length;e<f;e++){d=a.adapters[e].valid()?a.adapters[e]:undefined;if(d)break}if(!d)throw"No valid adapter.";for(var g in d)this[g]=d[g];for(var e=0,f=a.plugins.length;e<f;e++)a.plugins[e].call(this);this.init(b,c)};return a.adapters=[],a.adapter=function(b,c){c.adapter=b;var d="adapter valid init keys save batch get exists all remove nuke".split(" "),e=this.prototype.indexOf;for(var f in c)if(e(d,f)===-1)throw"Invalid adapter! Nonstandard method: "+f;a.adapters.splice(0,0,c)},a.plugins=[],a.plugin=function(b){for(var c in b)c==="init"?a.plugins.push(b[c]):this.prototype[c]=b[c]},a.prototype={isArray:Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"},indexOf:function(a,b,c,d){if(a.indexOf)return a.indexOf(b);for(c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},lambda:function(a){return this.fn(this.record,a)},fn:function(a,b){return typeof b=="string"?new Function(a,b):b},uuid:function(){var a=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},each:function(a){var b=this.lambda(a);if(this.__results)for(var c=0,d=this.__results.length;c<d;c++)b.call(this,this.__results[c],c);else this.all(function(a){for(var c=0,d=a.length;c<d;c++)b.call(this,a[c],c)});return this}},a}),define("lawnchair/adapters/indexed-db.js",[],function(){return function(a){a.adapter("indexed-db",function(){function a(a,b){console.error("error in indexed-db adapter!",a,b)}var b="lawnchair",c=2,d=function(){return window.indexedDB||window.webkitIndexedDB||window.oIndexedDB||window.msIndexedDB},e=function(){return window.IDBTransaction||window.webkitIDBTransaction||window.mozIDBTransaction||window.oIDBTransaction||window.msIDBTransaction},f=function(){return window.IDBKeyRange||window.webkitIDBKeyRange||window.mozIDBKeyRange||window.oIDBKeyRange||window.msIDBKeyRange},g=function(){return window.IDBDatabaseException||window.webkitIDBDatabaseException||window.mozIDBDatabaseException||window.oIDBDatabaseException||window.msIDBDatabaseException},h=e()&&"READ_WRITE"in e()?e().READ_WRITE:"readwrite";return{valid:function(){return!!d()},init:function(e,f){this.idb=d(),this.waiting=[];var h=this.idb.open(this.name,c),i=this,j=i.fn(i.name,f),k=function(){return h.onupgradeneeded=h.onsuccess=h.error=null,j.call(i,i)},l=function(a,c){try{i.db.deleteObjectStore("teststore")}catch(d){}try{i.db.deleteObjectStore(b)}catch(e){}i.db.createObjectStore(b),i.store=!0};h.onupgradeneeded=function(a){i.db=h.result,i.transaction=h.transaction,l(a.oldVersion,a.newVersion)},h.onsuccess=function(b){i.db=h.result;if(i.db.version!=""+c){var d=i.db.version,e=i.db.setVersion(""+c);e.onsuccess=function(a){var b=e.result;e.onsuccess=e.onerror=null,l(d,c),b.oncomplete=function(){for(var a=0;a<i.waiting.length;a++)i.waiting[a].call(i);i.waiting=[],k()}},e.onerror=function(b){e.onsuccess=e.onerror=null,console.log("Failed to create objectstore "+b),a(b)}}else{i.store=!0;for(var f=0;f<i.waiting.length;f++)i.waiting[f].call(i);i.waiting=[],k()}},h.onblocked=function(a){console.log("onblocked!")},h.onerror=function(a){if(h.errorCode===g().VERSION_ERR)return i.idb.deleteDatabase(i.name),i.init(e,f);console.error("Failed to open database")}},save:function(c,d){if(!this.store){this.waiting.push(function(){this.save(c,d)});return}var e=this,f,g=function(a){f.onsuccess=f.onerror=null,d&&(c.key=a.target.result,e.lambda(d).call(e,c))},i=this.db.transaction(b,h),j=i.objectStore(b);return f=c.key?j.put(c,c.key):j.put(c),f.onsuccess=g,f.onerror=a,this},batch:function(a,b){var c=[],d=!1,e=this,f=function(b){c.push(b),d=c.length===a.length},g=setInterval(function(){d&&(b&&e.lambda(b).call(e,c),clearInterval(g))},200);for(var h=0,i=a.length;h<i;h++)this.save(a[h],f);return this},get:function(c,d){if(!this.store){this.waiting.push(function(){this.get(c,d)});return}var e=this,f=function(a){d&&e.lambda(d).call(e,a.target.result)};if(!this.isArray(c)){var g=this.db.transaction(b).objectStore(b).get(c);g.onsuccess=function(a){g.onsuccess=g.onerror=null,f(a)},g.onerror=function(b){console.log("Failed to find "+c),g.onsuccess=g.onerror=null,a(b)}}else{var h=[],i=!1,j=c,k=function(a){h.push(a),i=h.length===j.length,i&&e.lambda(d).call(e,h)};for(var l=0,m=j.length;l<m;l++)this.get(j[l],k)}return this},exists:function(c,d){if(!this.store){this.waiting.push(function(){this.exists(c,d)});return}var e=this,g=this.db.transaction(b).objectStore(b).openCursor(f().only(c));return g.onsuccess=function(a){g.onsuccess=g.onerror=null;var b;e.lambda(d).call(e,a.target.result!==null&&a.target.result!==b)},g.onerror=function(b){g.onsuccess=g.onerror=null,console.log("Failed to test for "+c),a(b)},this},all:function(a){if(!this.store){this.waiting.push(function(){this.all(a)});return}var c=this.fn(this.name,a)||undefined,d=this,e=this.db.transaction(b).objectStore(b),f=[];return e.openCursor().onsuccess=function(a){var b=a.target.result;b?(f.push(b.value),b["continue"]()):c&&c.call(d,f)},this},remove:function(c,d){if(!this.store){this.waiting.push(function(){this.remove(c,d)});return}typeof c=="object"&&(c=c.key);var e=this,f,g=function(){f.onsuccess=f.onerror=null,d&&e.lambda(d).call(e)};return f=this.db.transaction(b,h).objectStore(b)["delete"](c),f.onsuccess=g,f.onerror=a,this},nuke:function(c,d){if(!this.store){this.waiting.push(function(){this.nuke(c,d)});return}var e=this,f=c?function(){e.lambda(c).call(e)}:function(){};if(d){this.waiting.length&&a(),this.idb.deleteDatabase(this.name),delete this.store,delete this.waiting,f();return}try{this.db.transaction(b,h).objectStore(b).clear().onsuccess=f}catch(g){a()}return this}}}())}}),define("lawnchair/adapters/dom.js",[],function(){return function(a){a.adapter("dom",function(){var a=window.localStorage,b=function(b){return{key:b+"._index_",all:function(){var b=a.getItem(this.key);return b&&(b=JSON.parse(b)),b===null&&a.setItem(this.key,JSON.stringify([])),JSON.parse(a.getItem(this.key))},add:function(b){var c=this.all();c.push(b),a.setItem(this.key,JSON.stringify(c))},del:function(b){var c=this.all(),d=[];for(var e=0,f=c.length;e<f;e++)c[e]!=b&&d.push(c[e]);a.setItem(this.key,JSON.stringify(d))},find:function(a){var b=this.all();for(var c=0,d=b.length;c<d;c++)if(a===b[c])return c;return!1}}};return{valid:function(){return!!a},init:function(a,c){this.indexer=b(this.name),c&&this.fn(this.name,c).call(this,this)},save:function(b,c){var d=b.key?this.name+"."+b.key:this.name+"."+this.uuid();return this.indexer.find(d)===!1&&this.indexer.add(d),delete b.key,a.setItem(d,JSON.stringify(b)),b.key=d.slice(this.name.length+1),c&&this.lambda(c).call(this,b),this},batch:function(a,b){var c=[];for(var d=0,e=a.length;d<e;d++)this.save(a[d],function(a){c.push(a)});return b&&this.lambda(b).call(this,c),this},keys:function(a){if(a){var b=this.name,c=this.indexer.all().map(function(a){return a.replace(b+".","")});this.fn("keys",a).call(this,c)}return this},get:function(b,c){if(this.isArray(b)){var d=[];for(var e=0,f=b.length;e<f;e++){var g=this.name+"."+b[e],h=a.getItem(g);h&&(h=JSON.parse(h),h.key=b[e],d.push(h))}c&&this.lambda(c).call(this,d)}else{var g=this.name+"."+b,h=a.getItem(g);h&&(h=JSON.parse(h),h.key=b),c&&this.lambda(c).call(this,h)}return this},exists:function(a,b){var c=this.indexer.find(this.name+"."+a)===!1?!1:!0;return this.lambda(b).call(this,c),this},all:function(b){var c=this.indexer.all(),d=[],e,f;for(var g=0,h=c.length;g<h;g++)f=c[g],e=JSON.parse(a.getItem(f)),e.key=f.replace(this.name+".",""),d.push(e);return b&&this.fn(this.name,b).call(this,d),this},remove:function(b,c){var d=this.name+"."+(b.key?b.key:b);return this.indexer.del(d),a.removeItem(d),c&&this.lambda(c).call(this),this},nuke:function(a){return this.all(function(b){for(var c=0,d=b.length;c<d;c++)this.remove(b[c]);a&&this.lambda(a).call(this)}),this}}}())}}),define("lawnchair/adapters/window-name.js",[],function(){return function(a){a.adapter("window-name",function(a,b){typeof window=="undefined"&&(window={top:{}});var c=window.top.name?JSON.parse(window.top.name):{};return{valid:function(){return typeof window.top.name!="undefined"},init:function(d,e){c[this.name]=c[this.name]||{index:[],store:{}},a=c[this.name].index,b=c[this.name].store,this.fn(this.name,e).call(this,this)},keys:function(b){return this.fn("keys",b).call(this,a),this},save:function(d,e){var f=d.key||this.uuid();return this.exists(f,function(g){g||(d.key&&delete d.key,a.push(f)),b[f]=d,window.top.name=JSON.stringify(c),e&&(d.key=f,this.lambda(e).call(this,d))}),this},batch:function(a,b){var c=[];for(var d=0,e=a.length;d<e;d++)this.save(a[d],function(a){c.push(a)});return b&&this.lambda(b).call(this,c),this},get:function(a,c){var d;if(this.isArray(a)){d=[];for(var e=0,f=a.length;e<f;e++)d.push(b[a[e]])}else d=b[a],d&&(d.key=a);return c&&this.lambda(c).call(this,d),this},exists:function(a,c){return this.lambda(c).call(this,!!b[a]),this},all:function(c){var d=[];for(var e=0,f=a.length;e<f;e++){var g=b[a[e]];g.key=a[e],d.push(g)}return this.fn(this.name,c).call(this,d),this},remove:function(d,e){var f=this.isArray(d)?d:[d];for(var g=0,h=f.length;g<h;g++)delete b[f[g]],a.splice(this.indexOf(a,f[g]),1);return window.top.name=JSON.stringify(c),e&&this.lambda(e).call(this),this},nuke:function(d){return b={},a=[],window.top.name=JSON.stringify(c),d&&this.lambda(d).call(this),this}}}())}}),define("lawnchair/lawnchair",["./core","./adapters/indexed-db.js","./adapters/dom.js","./adapters/window-name.js"],function(a){for(var b=arguments.length-1;b>0;b--)arguments[b](a);return a}),define("nell",["./alea","./lawnchair/lawnchair"],function(a,b){var c=["n0","n1","n2","n3","n4","n5","n6","n7","n8","n9","n10"],d=a.Random(),e=function(a,b,c,d){a.exists(b,function(e){e?a.get(b,d):d(c)})},f=function(a,b){this.lawnchair=a,b?this.setColor(b):(this.setColor(d.choice(c)),this.saveColor())};f.prototype={},f.prototype.setColor=function(a){document.body.classList.remove(this.color||"n0"),this.color=a,document.body.classList.add(this.color)},f.prototype.saveColor=function(){this.lawnchair.save({key:"color",value:this.color,timestamp:Date.now()},function(){})},f.prototype.switchColor=function(){var a=c.filter(function(a){return a!==this.color}.bind(this));this.setColor(d.choice(a)),this.saveColor(),this.funf&&this.funf.record("colorchange",this.color)};var g=function(a){var c=function(b){e(b,"color",null,function(c){a(new f(b,c&&c.value))})};b({name:"nell"},function(){c(this)})};return{load:function(a,b,c,d){d.isBuild||typeof document=="undefined"?c(null):g(c)}}}),define("score",["./lawnchair/lawnchair"],function(a){var b=function(a,b,c,d){a.exists(b,function(e){e?a.get(b,d):d(c)})},c=function(a,b){this.lawnchair=a,this.unlocked=b||{}};c.prototype={},c.prototype._get=function(a,b,c){if(!this.unlocked[a]){if(!c)return{};this.unlocked[a]={}}if(!this.unlocked[a][b]){if(!c)return{};this.unlocked[a][b]={}}return this.unlocked[a][b]},c.prototype.isCompleted=function(a,b){return!!this._get(a,b).firstCompleted},c.prototype.numStars=function(a,b){return this._get(a,b).numStars||0},c.prototype.setCompleted=function(a,b,c){var d=this._get(a,b,!0),e=d.numStars||0,f=!d.firstCompleted||c>e;if(!f)return;d.firstCompleted||(d.firstCompleted=Date.now()),d.lastCompleted=Date.now(),d.numStars=c,this.funf&&this.funf.record("unlocked",{level:a,altitude:b,numStars:c,firstCompleted:d.firstCompleted}),this.save()},c.prototype.save=function(){this.lawnchair.save({key:"unlocked",value:this.unlocked})};var d=function(d){var e=function(a){b(a,"unlocked",{},function(b){d(new c(a,b.value))})};a({name:"score"},function(){e(this)})};return{load:function(a,b,c,e){e.isBuild||typeof document=="undefined"?c(null):d(c)}}}),define("sound",[],function(){function d(){}function f(a,b){var c=new a({url:b.url,instances:b.instances,callback:b.callback,errback:b.errback})}function g(b){var c=b.url;if(!c)throw"you must pass a URL to Effect.";var f=new e(c,b.formats||[],b.instances||a,b.callback?function(a,b){return function(){b(a)}}(this,b.callback):d,b.errback||d);this.__defineGetter__("audio",function(){return f.getInstance()}),this.__defineGetter__("url",function(){return c}),this.play=function(){var a=this.audio;return a?(a.play(),a):null},this.loop=function(){f.loop()},this.unloop=function(){f.unloop()}}function h(a){a.instances=1,g.call(this,a)}var a=4,b={mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",aac:"audio/aac",m4a:"audio/x-m4a"},c=function(){return"Audio"in window?window.Audio:function(){return document.createElement("audio")}}(),e=function(a,d,e,f,g){var h=new c,i=!1,j=[];h.autobuffer=!0,h.preload="auto",h.addEventListener("error",function(){g(h.error)},!1),h.addEventListener("canplaythrough",function(){if(i)return;while(e--)j.push(h.cloneNode(!0));i=!0,f()},!1);var k=function(a){return a.split(".").pop()},l=function(a){var c=document.createElement("source");c.src=a,b[k(a)]&&(c.type=b[k(a)]),h.appendChild(c)};d&&d.length>0?d.forEach(function(b){l(a+"."+b)}):l(a),this.getInstance=function(){var a,b,c;for(c=0,b=j.length;c<b;c++){a=j[c];if(a.paused||a.ended)return a.ended&&(a.currentTime=0),a}return j.length===0?null:(a=j[0],a.pause(),a.currentTime=0,a)};var m=function(){h.currentTime=0,h.play()};this.loop=function(){h.loop=!0,h.addEventListener("ended",m,!1),h.play()},this.unloop=function(){if(!h.loop)return;h.pause(),h.removeAttribute("loop"),h.removeEventListener("ended",m,!1),h.currentTime=0}};return window.cordovaDetect&&(e=function(a,b,c,d,e){var f=[],g=[];a="/android_asset/www/"+a,b&&b.length>0&&(a+="."+b[0]),this.getInstance=function(){var b,d,e;for(e=0,d=f.length;e<d;e++){b=f[e];if(g[e])return b.seekTo(0),g[e]=!1,b}return d<c?(f[d]=b=new Media(a,function(){g[d]=!0}),g[d]=!1,b):f.length===0?null:(b=f[0],b.seekTo(0),b)};var h=null;this.loop=function(){var b;h&&this.unloop();var c=function(){if(h===null||h.id!==b.id)return;b.seekTo(0),b.play()};h=b=new Media(a,c),h.play()},this.unloop=function(){var a=h;h=null,a&&(a.stop(),a.release())},d()}),g.load=function(a){f(g,a)},h.load=function(a){f(h,a)},{Effect:g,Track:h}}),define("version",[],function(){return"6"}),define("index",["domReady!","./alea","./compat","./funf","nell!","score!","sound","./version"],function(a,c,d,e,f,g,h,j){function bH(){A.record("startColor",f.color),A.record("startVersion",j),window.GameMode=bm,bm.Menu.switchLevel(bo[0]),bm.switchTo(bm.Menu),v&&(history.replaceState(bm.currentMode.toJSON(),k+" | Menu","#menu"),window.addEventListener("popstate",bF,!1)),window.addEventListener("orientationchange",bG,!1),"orientation"in window&&bG(),a.addEventListener("backbutton",function(){v?history.back():bm.currentMode===bm.Playing&&bm.switchTo(bm.Menu)},!1),a.addEventListener("pause",bz,!1),a.addEventListener("resume",bA,!1),bD();var b=window.device&&window.device.platform==="Android"&&window.device.name==="tervigon";b||a.body.classList.add("anim")}var k=a.title="Nell's Balloons",l="sounds/barrios_gavota",m=["black","lilac","orange","yellow"],n=.05,o=.8,p=.25,q=1e3,r=n,s=2,t=!1,u=!1,v=history.pushState&&history.replaceState,w=c.Random(),x=a.getElementById("game"),y=a.getElementById("buttons"),z=a.getElementById("balloons"),A=f.funf=g.funf=new e("NellBalloons"+j),B,C,D,E,F=["ground","troposphere","stratosphere","mesosphere"];F.forEach(function(a,b){F[a]=b}),F.toNum=function(a){return F[a]};var G=[["a1",1],["a2",.5],["a3",1/8+1/6],["a4",.1875],["a5",.13125],["a6",1/64+1/12]],H=function(a,b){var c;for(c=0;c<a.length;c++)b(a[c],c)},I=0,J=function(){I=(I+1)%6;var a,b;for(a=0,sum=0;a<G.length;a++){if(!I){b=E[G[a][0]];if(b.size>=0)continue}sum+=G[a][1]}var c=w()*sum;for(a=0,sum=0;a<G.length;a++){if(!I){b=E[G[a][0]];if(b.size>=0)continue}sum+=G[a][1];if(c<sum)return G[a][0]}return G[G.length-1][0]},K=function(){var b;for(b=0;b<G.length;b++){var c=E[G[b][0]];if(c.size>=0){c.shrink();if(c.size<0){var d=a.querySelector("#awards .award."+G[b][0]);d.classList.remove("show")}return}}},L=function(){for(i=0;i<G.length;i++){var a=E[G[i][0]];if(a.size<0)return}if(bm.currentMode!==bm.Playing)return;var b=G.map(function(a){return E[a[0]].size});A.record("mode",{name:"playing",type:"levelcomplete",stars:bt.stars,streak:bt.streak,smoothedHeight:bt.smoothedHeight,sprouts:b,level:bm.Playing.currentLevel.num,altitude:F.toNum(bm.Playing.currentAltitude)}),g.setCompleted(bm.Playing.currentLevel.levelClass,bm.Playing.currentAltitude,bt.stars),bd(),bk[0].play(),bm.StarThrob.push()},M=function(a,b){this.domElement=a,this.domElement.classList.add(b),this.color=b};M.prototype={},M.prototype.reset=function(a){this.domElement.classList.remove(this.color),this.domElement.classList.add(a),this.color=a},M.prototype.attach=function(a){a.appendChild(this.domElement)},M.prototype.detach=function(){this.domElement.parentElement.removeChild(this.domElement)};var N=function(b){M.call(this,a.createElement("a"),b),this.domElement.href="#";var c=!!window.cordovaDetect;["mousedown","touchstart"].forEach(function(a){if(c&&a[0]==="m")return;this.domElement.addEventListener(a,this.highlight.bind(this),!1)}.bind(this)),["mouseup","mouseout","touchcancel","touchend"].forEach(function(a){if(c&&a[0]==="m")return;this.domElement.addEventListener(a,this.unhighlight.bind(this),!1)}.bind(this)),this.domElement.addEventListener("click",function(a){a.preventDefault()},!1),this.ignoreMouse=!1};N.prototype=Object.create(M.prototype),N.prototype.highlight=function(a){switch(a.type){case"touchstart":this.ignoreMouse=!0;break;case"mousedown":if(this.ignoreMouse)return}this.domElement.classList.add("hover"),a.preventDefault(),this.fast&&this.ignoreMouse&&this.handleClick()},N.prototype.unhighlight=function(a){switch(a.type){case"mouseup":case"mouseout":if(this.ignoreMouse)return}this.domElement.classList.remove("hover"),a.preventDefault(),a.type!=="touchcancel"&&a.type!=="mouseout"&&(!this.fast||!this.ignoreMouse)&&this.handleClick(),this.ignoreMouse=!1};var O=function(a){N.call(this,a),this.attach(y),this.fast=!0};O.prototype=Object.create(N.prototype),O.prototype.handleClick=function(){if(bm.currentMode!==bm.Playing)return;C(this.color)};var P=function(a){N.call(this,"tag"),this.altitude=a};P.prototype=Object.create(N.prototype),P.prototype.handleClick=function(){this.altitudeClicked(this.altitude)};var Q=function(b){b=b||w.choice(B).color,M.call(this,a.createElement("div"),b),this.balloon=a.createElement("div"),this.balloon.classList.add("balloon"),this.payload=a.createElement("div"),this.payload.classList.add("payload"),this.domElement.appendChild(this.payload),this.domElement.appendChild(this.balloon),this.attach(z),this.reset(this.color),this.refresh()};Q.prototype=Object.create(M.prototype),Q.prototype.doBirth=function(){this.born=!0,this.bornTime=Date.now(),this.pauseTime=0,this.height=this.domElement.offsetHeight,this.maxx=z.offsetWidth-this.domElement.offsetWidth,this.x=Math.floor(w()*this.maxx),this.y=z.offsetHeight,this.fastY=this.y-this.height,this.speedy=(.9+.2*w())*r,this.speedx=(2*w()-1)*this.speedy*p,A.record("born",this.color)},Q.prototype.reset=function(a){a=a||w.choice(B).color,a!==this.color&&M.prototype.reset.call(this,a),this.born=!1,this.bornTime=this.pauseTime=0,this.bornTimeout=0,this.popped=this.popDone=!1,this.domElement.classList.remove("popped"),this.domElement.classList.remove("squirt"),this.domElement.classList.remove("payload-dropped"),this.award=null,this.x=0,this.y=z.offsetHeight},Q.prototype.refresh=function(){if(this.popped)return;var a=Math.round(this.x)+"px,"+Math.round(this.y)+"px";this.domElement.style.WebkitTransform="translate3d("+a+",0)",this.domElement.style.MozTransform=this.domElement.style.transform="translate("+a,NaN},Q.prototype.update=function(b){if(!this.born){this.bornTimeout-=b,this.bornTimeout<0&&this.doBirth();return}if(this.popped){this.popTimeout-=b;if(this.popTimeout<0){this.popDone=!0,this.domElement.classList.contains("squirt")&&w.choice(bf).play();if(this.award){var c=a.querySelector("#awards .award."+this.award),d=E[this.award];d.size>=0&&c.classList.add("show"),c.style.WebkitTransform=c.style.MozTransform=c.style.transform="";var e=a.querySelector("#awards .award.flex");e.style.display="none",L()}}return}if(this.y>this.fastY){var f=(this.y-this.fastY)/o;f>b?this.y-=b*o:this.y=this.fastY-(b-f)*this.speedy}else this.y-=b*this.speedy;this.x+=b*this.speedx,this.x<0&&(this.x=0,this.speedx=0),this.x>this.maxx&&(this.x=this.maxx,this.speedx=0)},Q.prototype.isGone=function(){return this.born?this.y<-this.height||this.popDone:!1},Q.prototype.pop=function(){this.popped=!0;var b=w()<1/3.5;u&&(b=!0);var c=w()<1/15,d=b?bj:c?bg:bf;w.choice(d).play(),this.domElement.classList.add("payload-dropped");if(b){this.domElement.classList.add("popped"),this.popTimeout=250,this.award=J();var e=a.querySelector("#awards .award."+this.award),f=E[this.award];if(f.size>=0){var g=a.querySelector("#awards .award.flex");g.style.top=e.offsetTop+"px",g.style.left=e.offsetLeft+"px",g.style.display="block",g.className="award flex "+this.award,e=g,this.popTimeout=750}var h=e.offsetTop+e.offsetParent.offsetTop,i=e.offsetLeft+e.offsetParent.offsetLeft,j=Math.round(this.x-i+23),k=Math.round(this.y-h+20),l=j+"px,"+k+"px";e.style.WebkitTransform="translate3d("+l+",0)",e.style.MozTransform=e.style.transform="translate("+l+")",f.grow(),U()}else c?(this.domElement.classList.add("squirt"),this.popTimeout=2e3):(this.domElement.classList.add("popped"),this.popTimeout=250)};var R=function(){var a=[[.143,.078]],b=function(b,c){var d,e,f,g=a[a.length-1];for(d=1;d<=b;d++)e=(c[0]-g[0])*d/b,f=(c[1]-g[1])*d/b,a.push([g[0]+e,g[1]+f])};return b(1,[.215,.118]),b(1,[.287,.156]),b(5,[.857,.469]),b(16,[1,1]),Object.freeze(a),a}(),S=function(b){this.awardClass=b,this.domElement=a.querySelector("#sprouts .award."+b),this.setSize(-1)};S.prototype={},S.prototype.grow=function(){this.setSize(this.size+1)},S.prototype.shrink=function(){this.setSize(this.size-1)},S.prototype.setSize=function(a){var b,c,d;a=Math.max(-1,Math.min(a,R.length-1)),a=Math.round(a);if(this.size===a)return;this.size=a,a<0?(this.domElement.classList.remove("show"),b=c=""):(this.domElement.classList.add("show"),d=R[a],b="scale("+d[0]+","+d[1]+")",c="translate3d(0,0,0) "+b),this.domElement.style.WebkitTransform=c,this.domElement.style.MozTransform=this.domElement.style.transform=b,this.setTime()},S.prototype.setTime=function(a,b){this.domElement.style.webkitTransitionDuration=this.domElement.style.mozTransitionDuration=this.domElement.style.transitionDuration=a||"",this.domElement.style.webkitTransitionDelay=this.domElement.style.mozTransitionDelay=this.domElement.style.transitionDelay=b||""},E={},G.forEach(function(a){E[a[0]]=new S(a[0])}),Object.freeze(E);var T=function(){if(!(g.recent&&g.recent.length>=G.length))return;G.forEach(function(b,c){var d=E[b[0]];d.setSize(g.recent[c]);if(d.size>=0){var e=a.querySelector("#awards .award."+b[0]);e.classList.add("show")}})},U=function(){var a=G.map(function(a){return E[a[0]].size});g.save(a)};B=[];var V=function(){while(B.length>0)b=B.pop(),b.detach();var a=m.slice(0);w.shuffle(a),a.forEach(function(a){var b=new O(a);B.push(b)})};V();var W=function(a){var b=a.changedTouches,c,d;for(c=0;c<b.length;c++){var e=b[c];for(d=0;d<B.length;d++){var f=B[d];e.target===f.domElement&&(a.type==="touchstart"?(f.domElement.classList.add("hover"),f.handleClick()):f.domElement.classList.remove("hover"))}}return a.stopPropagation(),a.preventDefault(),!1};["touchstart","touchend","touchcancel"].forEach(function(b){a.getElementById("buttons").addEventListener(b,W,!0)}),altitudeStars=[];var X=function(){F.forEach(function(b){var c=new P(b);c.attach(a.querySelector("#menu .awards > ."+b)),altitudeStars.push(c)})};X();var Y=[];while(Y.length<s)Y.push(new Q);var Z=null,$=function(){return null},_=function(){},ba=function(a){a.y<-4?Y.forEach(function(a){a.speedx-=50}):a.y>4&&Y.forEach(function(a){a.speedx+=50})};navigator.accelerometer&&($=function(){return navigator.accelerometer.watchAcceleration(ba,function(){},{frequency:80})},_=function(a){navigator.accelerometer.clearWatch(a)});var bb,bc=function(a){bb&&bb.origSrc!==a&&(bd(),bb=null),bb||(bb=new h.Track({url:a,formats:["ogg","mp3"]}),bb.origSrc=a),bb.loop()},bd=function(){bb&&bb.unloop()},be=function(a){return a.map(function(a){return new h.Effect({url:a,instances:2,formats:["ogg","mp3"]})})},bf=be(["sounds/burst1","sounds/burst2","sounds/burst3","sounds/burst4","sounds/burst5","sounds/burst6","sounds/burst7"]),bg=be(["sounds/deflate1","sounds/deflate2"]),bh=be(["sounds/wrong1"]),bi=be(["sounds/wrong2"]),bj=be(["sounds/award"]),bk=be(["sounds/levelwin","sounds/levellose"]),bl=function(a,b,c,d){var e=d?b&&b[d]:b,f=d?c[d]:c;return e&&a.classList.remove(e),a.classList.add(f),c},bm=function(a){this.bodyClass=a,this.active=!1};bm.prototype={},bm.prototype.enter=function(){this.resume(),a.body.classList.add(this.bodyClass),this.active=!0},bm.prototype.leave=function(){this.pause(),a.body.classList.remove(this.bodyClass),this.active=!1},bm.prototype.pause=function(){a.body.classList.add("paused")},bm.prototype.resume=function(){a.body.classList.remove("paused")},bm.prototype.toJSON=function(){return{mode:this.bodyClass}},bm.currentMode=null,bm.switchTo=function(a){bm.currentMode&&bm.currentMode.leave(),bm.currentMode=a,bm.currentMode.enter()},bm.Menu=new bm("menu"),bm.Menu.toJSON=function(){return{mode:"Menu",level:this.currentLevel.num}},bm.Menu.enter=function(a){return function(){a.call(this),A.record("mode",{name:"menu"}),this.syncExposed()}}(bm.Menu.enter),bm.Menu.start=function(a){if(bm.Playing.currentLevel!==this.currentLevel||bm.Playing.currentAltitude!==a)bm.Playing.switchLevel(this.currentLevel),bm.Playing.switchAltitude(a),bm.Playing.reset();v&&history.replaceState(bm.currentMode.toJSON(),k+" | Menu","#menu"),bm.switchTo(bm.Playing),v&&history.pushState(bm.currentMode.toJSON(),k+" | Play!","#play"),A.record("mode",{name:"playing",type:"levelstart",level:bm.Playing.currentLevel.num,altitude:F.toNum(bm.Playing.currentAltitude)})},bm.Menu.switchLevel=function(b){var c=a.querySelector("#menu .level");this.currentLevel=bl(c,this.currentLevel,b,"levelClass");var d=a.querySelector("#menu .levelnav .dot.on");d&&d.classList.remove("on"),b.dot.classList.add("on");var e=a.querySelector("#menu .levelnav .prev");e.classList.remove("hidden"),b.prevLevel||e.classList.add("hidden");var f=a.querySelector("#menu .levelnav .next");f.classList.remove("hidden"),b.nextLevel||f.classList.add("hidden"),this.syncExposed()},bm.Menu.syncExposed=function(){this.setExposed("none",0);if(this.currentLevel.prevLevel&&!g.isCompleted(this.currentLevel.prevLevel.levelClass,F[F.length-1]))return;for(i=0;i<F.length;i++){var a=g.numStars(this.currentLevel.levelClass,F[i]);this.setExposed(F[i],a);if(!g.isCompleted(this.currentLevel.levelClass,F[i]))break}},bm.Menu.setExposed=function(b,c){var d=a.querySelector("#menu .level"),e=this.currentExposed&&"exposed-"+this.currentExposed;bl(d,e,"exposed-"+b),this.currentExposed=b;if(b==="none")return;var f=a.querySelector("#menu .awards > ."+b+" > .stars");["zero","one","two","three"].forEach(function(a,b){c===b?f.classList.add(a):f.classList.remove(a)})},bm.Menu.prevClicked=function(){if(!this.currentLevel.prevLevel)return;this.switchLevel(this.currentLevel.prevLevel)},bm.Menu.nextClicked=function(){if(!this.currentLevel.nextLevel)return;this.switchLevel(this.currentLevel.nextLevel)},["prev","next"].forEach(function(b){var c=new N(b);c.attach(a.querySelector("#menu .levelnav .inner")),c.handleClick=bm.Menu[b+"Clicked"].bind(bm.Menu),bm.Menu[b+"Arrow"]=c}),P.prototype.altitudeClicked=bm.Menu.start.bind(bm.Menu),bm.OverlayMode=function(a){bm.call(this,a),this.underMode=null},bm.OverlayMode.prototype=Object.create(bm.prototype),bm.OverlayMode.prototype.setUnderMode=function(b){this.underMode=this.active?bl(a.body,this.underMode,b,"bodyClass"):b},bm.OverlayMode.prototype.push=function(){this.setUnderMode(bm.currentMode.underMode||bm.currentMode),bm.switchTo(this)},bm.OverlayMode.prototype.pop=function(){console.assert(bm.currentMode===this),bm.switchTo(this.underMode)},bm.OverlayMode.prototype.enter=function(b){return function(){b.call(this),this.underMode&&a.body.classList.add(this.underMode.bodyClass)}}(bm.OverlayMode.prototype.enter),bm.OverlayMode.prototype.leave=function(b){return function(){b.call(this),this.underMode&&a.body.classList.remove(this.underMode.bodyClass)}}(bm.OverlayMode.prototype.leave),bm.TransitionOverlayMode=function(a,b){bm.OverlayMode.call(this,a),this.delayMs=b,this.switchId=null},bm.TransitionOverlayMode.prototype=Object.create(bm.OverlayMode.prototype),bm.TransitionOverlayMode.prototype.nextMode=function(){},bm.TransitionOverlayMode.prototype.enter=function(a){return function(){a.call(this);var b=window.device&&window.device.platform==="Android",c=this.delayMs;this.switchTime=Date.now()+c,this.switchId=setTimeout(this.switchMode.bind(this),b&&c?250:c)}}(bm.TransitionOverlayMode.prototype.enter),bm.TransitionOverlayMode.prototype.leave=function(a){return function(){a.call(this);if(this.switchId===null)return;clearTimeout(this.switchId),this.switchId=null}}(bm.TransitionOverlayMode.prototype.leave),bm.TransitionOverlayMode.prototype.switchMode=function(){if(Date.now()<this.switchTime){this.switchId=setTimeout(this.switchMode.bind(this),10);return}this.switchId=null,this.nextMode()||this.pop()},bm.StarThrob=new bm.TransitionOverlayMode("starthrob",5e3),bm.StarThrob.enter=function(a){return function(){this.delayMs=bt.stars===0?0:5e3,a.call(this)}}(bm.StarThrob.enter),bm.StarThrob.nextMode=function(){var a=!!window.cordovaDetect;return G.forEach(function(b){var c=E[b[0]];c.size>=0&&(a?c.setSize(-1):(c.setSize(R.length),c.setTime("3s")))}),a&&(bm.SproutsGrow.delayMs=0),bm.SproutsGrow.push(),!0},bm.SproutsGrow=new bm.TransitionOverlayMode("sproutsgrow",3e3),bm.SproutsGrow.nextMode=function(){return bm.Video.push(),!0},bm.Video=new bm.OverlayMode("video"),bm.Video.enter=function(b){return function(){b.call(this),this.maybeUnloadVideo();var c=bm.Playing.currentLevel,d=bm.Playing.currentAltitude,e=a.querySelector("#video > .inner");this.videoElement=a.createElement("video"),this.videoElement.preload="auto",this.videoElement.volume=1,this.videoElement.muted=!1,this.videoElement.addEventListener("canplay",this.canPlay.bind(this),!1),["webm"].forEach(function(b){var e=a.createElement("source");e.type="video/"+b,e.src=c.videoFor(d,b),this.videoElement.appendChild(e)}.bind(this)),e.insertBefore(this.videoElement,e.firstChild),this.videoElement.load()}}(bm.Video.enter),bm.Video.canPlay=function(){this.videoElement.addEventListener("ended",this.playEnded.bind(this),!1),this.videoElement.play(),a.querySelector("#video").classList.add("playing")},bm.Video.playEnded=function(){a.querySelector("#video").classList.remove("playing")},bm.Video.maybeUnloadVideo=function(){this.videoElement&&(this.videoElement.parentElement.removeChild(this.videoElement),this.videoElement=null),a.querySelector("#video").classList.remove("playing")},bm.Video.leave=function(a){return function(){this.maybeUnloadVideo(),a.call(this)}}(bm.Video.leave),bm.Video.arrow=new N("arrow"),bm.Video.arrow.attach(a.querySelector("#video > .inner")),bm.Video.arrow.handleClick=function(){bm.LevelDone.push()},bm.LevelDone=new bm.TransitionOverlayMode("leveldone",0),bm.LevelDone.nextMode=function(){return bm.Playing.nextAltitude()?(bm.Playing.reset(),G.forEach(function(a){var b=E[a[0]];b.setTime("0s","1s")}),!1):v?(this.currentLevel=bm.Playing.currentLevel,history.back(),!0):(bm.Menu.switchLevel(bm.Playing.currentLevel),bm.switchTo(bm.Menu),!0)},bm.Rotate=new bm.OverlayMode("rotate"),bm.Playing=new bm("game"),bm.Playing.toJSON=function(){return{mode:"Playing",level:this.currentLevel.num,altitude:this.currentAltitude}},bm.Playing.reset=function(){r=n,Y.forEach(function(a,b){a.reset(),a.bornTimeout=1e3+b*q,a.x=z.offsetWidth||-1e3,a.y=z.offsetHeight||-1e3,a.refresh()}),G.forEach(function(a){var b=E[a[0]];b.setSize(-1),b.setTime("0s")}),H(a.querySelectorAll("#awards .award"),function(a){a.classList.remove("show"),a.style.WebkitTransform=a.style.MozTransform=a.style.transform=""});var b=a.querySelector("#awards .award.flex");b.style.display="none",bt.reset()},bm.Playing.switchLevel=function(b){var c=a.querySelector("#game #level");this.currentLevel=bl(c,this.currentLevel,b,"levelClass")},bm.Playing.switchAltitude=function(b){var c=a.querySelector("#game #level");this.currentAltitude=bl(c,this.currentAltitude,b)},bm.Playing.nextAltitude=function(){var a=(F.toNum(this.currentAltitude)+1)%F.length;if(a===0){var b=this.currentLevel.nextLevel;if(b===null)return!1;this.switchLevel(b)}return this.switchAltitude(F[a]),!0},bm.Playing.pause=function(a){return function(){a.call(this),this.pauseTime=Date.now(),A.record("status","pause"),bd(),D.id!==null&&(d.cancelAnimationFrame(D.id),D.id=null),Z!==null&&(_(),Z=null),U(),A.archive()}}(bm.Playing.pause),bm.Playing.resume=function(a){return function(){a.call(this);var b=this.pauseTime-Date.now();A.record("status","resume"),bc(this.currentLevel.audioUrl()),D.lastFrame=Date.now(),D.id===null&&(D.id=d.requestAnimationFrame(D)),Z===null&&t&&(Z=$()),Y.forEach(function(a){a.pauseTime+=b})}}(bm.Playing.resume),bm.Playing.pauseTime=Date.now();var bn=function(a){this.levelClass=a};bn.prototype={},bn.prototype.audioUrl=function(){var a="sounds/";switch(this.num){default:case 0:a+="barrios_gavota";break;case 1:a+="letting-go"}return a},bn.prototype.videoFor=function(a,b){var c="video/SpaceBalloon"+(1+this.num)+"-"+(1+F.toNum(a));return b==="mp4"?c+"-400k128-2pass.mp4":c+"-200k64.webm"};var bo=[new bn("grass")];bo.forEach(function(b,c){b.num=c,b.prevLevel=bo[c-1]||null,b.nextLevel=bo[c+1]||null,b.dot=a.createElement("div"),b.dot.classList.add("dot"),a.querySelector("#menu .levelnav .inner").appendChild(b.dot)});var bp=.8,bq=0,br=1e4,bs=function(a,b){var c=Math.max(b/.8,.8)*r,d=z.offsetHeight*.9/a,e=(c+d)/2,f=1.2,g=Math.max(r/f,n),h=Math.min(r*f,o);r=Math.max(g,Math.min(h,e))},bt={SMOOTHING:.85,domElement:a.querySelector("#ruler .foreground"),reset:function(){this.smoothedHeight=1,this.height=1,this.stars=0,this.streak=0,H(a.querySelectorAll("#ruler .stars"),function(a){a.classList.remove("highlight")}),this.domElement.style.height="100%"},adjust:function(b,c){var d=bm.Playing.currentAltitude,e;b?(c-=.1,this.streak++):(this.streak=0,c=1),this.smoothedHeight=Math.max(0,Math.min(1,bt.SMOOTHING*this.smoothedHeight+(1-bt.SMOOTHING)*c)),this.height=this.smoothedHeight*Math.max(.28,Math.pow(.98,this.streak));var f=25*(this.height+F.toNum(d));this.domElement.style.height=f+"%";var g=this.height<.28?3:this.height<.54?2:this.height<.79?1:0,h=function(b){return a.querySelector("#ruler ."+d+" .stars."+["zero","one","two","three"][b])};g!==this.stars&&(e=h(this.stars),e&&e.classList.remove("highlight"),this.stars=g,e=h(this.stars),e&&e.classList.add("highlight"))}};bt.reset();var bu=function(a,b,c){A.record("correct",{color:a,time:b}),br=bp*br+(1-bp)*b,bq=bp*bq+(1-bp),bs(br,bq),bt.adjust(!0,c)},bv=function(a,b){A.record("incorrect",{type:a,time:b});var c=br;b>br&&(c=bp*br+(1-bp)*b),bq=bp*bq,bs(c,bq),bt.adjust(!1,1)},bw=null,bx=null,by;C=function(a){var b,c,d=null;for(b=0;b<Y.length;b++)c=Y[b],c.color===a&&c.born&&!c.isGone()&&!c.popped&&(d===null||c.y<d.y)&&(d=c);if(d===null){if(bx!==null&&a==by)return;if(bw!==null)return;w.choice(bh).play(),bv("click."+a,Math.round(z.offsetHeight/r)),K(),U(),bw=window.setTimeout(function(){bw=null},500)}else d.pop(),bu(a,Date.now()-d.bornTime-d.pauseTime,1-Math.max(0,d.y/z.offsetHeight)),by=a,bx&&window.clearTimeout(bx),bx=window.setTimeout(function(){bx=null},500)};var bz=function(){bm.currentMode.pause()},bA=function(){bm.currentMode.resume()},bB="hidden",bC="visibilitychange";typeof a.hidden!="undefined"?(bB="hidden",bC="visibilitychange"):typeof a.mozHidden!="undefined"?(bB="mozHidden",bC="mozvisibilitychange"):typeof a.msHidden!="undefined"?(bB="msHidden",bC="msvisibilitychange"):typeof a.webkitHidden!="undefined"&&(bB="webkitHidden",bC="webkitvisibilitychange");var bD=function(){var b=!0;return function(c){var d=a[bB]||!1;if(b===d)return;b=d,d?bz():bA()}}();a.addEventListener(bC,bD,!1),D=function(){D.id=null;var a=Date.now(),b=!1,c=!1,e,f,g=Math.max(0,Math.min(a-D.lastFrame,100));for(e=0;e<Y.length;e++)f=Y[e],f.update(g),f.isGone()&&(f.popped||(c=!0,bv("escape."+f.color,a-f.bornTime-f.pauseTime)),b=!0,f.reset(),a-D.lastBorn<q?(f.bornTimeout=q-(a-D.lastBorn),D.lastBorn+=q):D.lastBorn=a),f.refresh();c&&w.choice(bi).play(),!b,D.lastFrame=a,bm.currentMode===bm.Playing&&(D.id=d.requestAnimationFrame(D))},D.id=null,D.lastFrame=Date.now(),D.lastBorn=0;var bE=function(a){a.type==="touchstart"&&a.target.removeEventListener("mousedown",bE,!1),a.preventDefault(),f.switchColor()};["mousedown","touchstart"].forEach(function(b){var c=!!window.cordovaDetect;if(c&&b[0]==="m")return;H(a.querySelectorAll(".nells > div > div"),function(a){a.addEventListener(b,bE,!1)})});var bF=function(a){var b=a.state;if(!b)return;if(!b.mode)return;switch(b.mode){case"Playing":bm.Playing.switchLevel(bo[b.level]),bm.Playing.switchAltitude(bo[b.altitude]),bm.switchTo(bm.Playing);break;case"Menu":bm.currentMode.currentLevel?bm.Menu.switchLevel(bm.currentMode.currentLevel):bm.Menu.switchLevel(bo[b.level]),bm.switchTo(bm.Menu)}},bG=function(a){var b=window.device&&window.device.platform==="Android"&&window.device.name==="tervigon";if(!b)return;var c=window.orientation!==0&&window.orientation!==180;a||(c=window.outerHeight>=window.outerWidth),c?bm.currentMode===bm.Rotate&&(bm.Rotate.pop(),A.record("orientation","portrait")):bm.currentMode!==bm.Rotate&&(bm.Rotate.push(),A.record("orientation","landscape"))};window.cordovaDetect?a.addEventListener("deviceready",bH,!1):(console.log("not on phonegap"),bH())})